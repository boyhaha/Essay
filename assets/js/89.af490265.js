(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{468:function(e,l,_){"use strict";_.r(l);var a=_(44),t=Object(a.a)({},(function(){var e=this,l=e.$createElement,_=e._self._c||l;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("h2",{attrs:{id:"database"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#database"}},[e._v("#")]),e._v(" "),_("strong",[e._v("database")])]),e._v(" "),_("ol",[_("li",[_("span",{staticStyle:{"background-color":"#ffaaaa"}},[e._v("models.ForeignKey（")]),e._v(" "),_("ul",[_("li",[e._v("related_name\n"),_("ul",[_("li",[e._v("定义之后就无法使用“_set”查询，会被“related_name”代替")]),e._v(" "),_("li",[e._v("如果")])])]),e._v(" "),_("li",[e._v("db_constraint=True\n"),_("ul",[_("li",[e._v("是否在数据库中创建外键约束")])])])])]),e._v(" "),_("li",[_("span",{staticStyle:{"background-color":"#ffaaaa"}},[e._v("@transaction.atomic（")]),e._v(" "),_("ul",[_("li",[e._v("开启数据库事物")])])]),e._v(" "),_("li",[e._v("查询条件\n"),_("ol",[_("li",[e._v("iexact： 忽略大小写的 like")]),e._v(" "),_("li",[e._v("exact：  like")])])]),e._v(" "),_("li",[e._v("优化\n"),_("ol",[_("li",[_("span",{staticStyle:{"background-color":"#ffaaaa"}},[_("span",{staticStyle:{"background-color":"#ffaaaa"}},[e._v("select_related()")])]),e._v(" "),_("ol",[_("li",[e._v("主要针一对一和多对一关系进行优化")]),e._v(" "),_("li",[e._v("使用SQL的JOIN语句进行优化，通过减少SQL查询的次数来进行优化、提高性能")]),e._v(" "),_("li",[e._v("可以通过可变长参数指定需要select_related的字段名。也可以通过使用双下划线“__”连接字段名来实现指定的递归查询，没有指定的字段不会缓存，没有指定的深度不会缓存，如果要访问的话Django会再次进行SQL查询。")]),e._v(" "),_("li",[e._v("也可以通过depth参数指定递归的深度，Django会自动缓存指定深度内所有的字段。如果要访问指定深度外的字段，Django会再次进行SQL查询")]),e._v(" "),_("li",[e._v("也接受无参数的调用，Django会尽可能深的递归查询所有的字段。但注意有Django递归的限制和性能的浪费。")]),e._v(" "),_("li",[e._v("Django >= 1.7，链式调用的select_related相当于使用可变长参数。Django < 1.7，链式调用会导致前边的select_related失效，只保留最后一个。")])])]),e._v(" "),_("li",[_("span",{staticStyle:{"background-color":"#ffaaaa"}},[_("span",{staticStyle:{"background-color":"#ffaaaa"}},[e._v("prefetch_related()")])]),e._v(" "),_("ol",[_("li",[e._v("prefetch_related主要针一对多和多对多关系进行优化。")]),e._v(" "),_("li",[e._v("prefetch_related通过分别获取各个表的内容，然后用Python处理他们之间的关系来进行优化。")]),e._v(" "),_("li",[e._v("可以通过可变长参数指定需要")]),e._v(" "),_("li",[e._v("在Django >= 1.7可以通过Prefetch对象来实现复杂查询，但低版本的Django好像只能自己实现。")]),e._v(" "),_("li",[e._v("作为prefetch_related的参数，Prefetch对象和字符串可以混用。")]),e._v(" "),_("li",[e._v("prefetch_related的链式调用会将对应的prefetch添加进去，而非替换，似乎没有基于不同版本上区别。")]),e._v(" "),_("li",[e._v("可以通过传入None来清空之前的prefetch_related。")])])]),e._v(" "),_("li",[_("span",{staticStyle:{"background-color":"#ffaaaa"}},[e._v("select_related")]),e._v(" "),_("ol",[_("li",[e._v("因为select_related()总是在单次SQL查询中解决问题，而prefetch_related()会对每个相关表进行SQL查询，因此select_related()的效率通常比后者高。")]),e._v(" "),_("li",[e._v("鉴于第一条，尽可能的用select_related()解决问题。只有在select_related()不能解决问题的时候再去想prefetch_related()。")]),e._v(" "),_("li",[e._v("你可以在一个QuerySet中同时使用select_related()和prefetch_related()，从而减少SQL查询的次数。")]),e._v(" "),_("li",[e._v("只有prefetch_related()之前的select_related()是有效的，之后的将会被无视掉。")]),e._v(" "),_("li",[e._v("select_related是通过join来关联多表，一次获取数据，存放在内存中，但如果关联的表太多，会严重影响数据库性能。prefetch_related是通过分表，先获取各个表的数据，存放在内存中，然后通过Python处理他们之间的关联。")])])]),e._v(" "),_("li",[e._v("bulk_create\n"),_("ol",[_("li",[e._v("Django（1.4之后）  model中批量导入数据")]),e._v(" "),_("li",[e._v("只连接一次数据库")])])])])]),e._v(" "),_("li",[e._v("BinaryField\n"),_("ol",[_("li",[e._v("在\n"),_("ol",[_("li",[e._v("用于存放原始二进制数据，或")]),e._v(" "),_("li",[e._v("MessagePack")]),e._v(" "),_("li",[e._v("传感器原始数据")]),e._v(" "),_("li",[e._v("压缩的数据。如")]),e._v(" "),_("li",[e._v("二进制数据串可以会很大，这将会拖慢数据库。此时应将内容保存在一个文件中，然后用")]),e._v(" "),_("li",[e._v("绝对不要通过\n"),_("ol",[_("li",[e._v("对数据库的读写比对文件系统更慢")]),e._v(" "),_("li",[e._v("你的数据库会变得越来越大，从而性能越来越低")]),e._v(" "),_("li",[e._v("此时访问文件需要经过")])])])])]),e._v(" "),_("li",[e._v("BinaryField")]),e._v(" "),_("li",[e._v("压缩时不会产生编码问题，")])])]),e._v(" "),_("li",[e._v("为什么用数字，而不直接写字符串\n"),_("ol",[_("li",[e._v("直接存 int 虽然可读性不高，但是效率高，有助于比较")]),e._v(" "),_("li",[e._v("修改状态的话可以不改动数据，只改动逻辑")]),e._v(" "),_("li",[e._v("字符串会降低查询和连接的性能，并会增加存储开销，因为引擎在处理查询和连接时会逐个比较字符串中的每一个字符，而数字型一个就够了")])])])])])}),[],!1,null,null,null);l.default=t.exports}}]);