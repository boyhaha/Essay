(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{396:function(t,e,r){"use strict";r.r(e);var _=r(44),a=Object(_.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"postgresql"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#postgresql"}},[t._v("#")]),t._v(" PostgreSQL")]),t._v(" "),r("h2",{attrs:{id:"常见命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#常见命令"}},[t._v("#")]),t._v(" 常见命令")]),t._v(" "),r("h3",{attrs:{id:"sql"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#sql"}},[t._v("#")]),t._v(" SQL")]),t._v(" "),r("ul",[r("li",[t._v("删除table\n"),r("ul",[r("li",[r("blockquote",[r("p",[t._v("DROP TABLE table_name;")])])])])]),t._v(" "),r("li",[t._v("seq\n"),r("ul",[r("li",[t._v("设置序列seq\n"),r("ul",[r("li",[r("blockquote",[r("p",[t._v("SELECT setval('table_id_seq', 1010);")])])])])]),t._v(" "),r("li",[t._v("删除序列\n"),r("ul",[r("li",[t._v("DROP SEQUENCE seq_name[, ...]")])])])])])]),t._v(" "),r("h2",{attrs:{id:"其他"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[t._v("#")]),t._v(" 其他")]),t._v(" "),r("h3",{attrs:{id:"安装"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("sudo env LDFLAGS='-L/usr/local/lib -L/usr/local/opt/openssl/lib\n-L/usr/local/opt/readline/lib' pip install psycopg2\n")])])]),r("h3",{attrs:{id:"数据导入-导出"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#数据导入-导出"}},[t._v("#")]),t._v(" 数据导入, 导出")]),t._v(" "),r("p",[t._v("-- pg_dump -h 生产数据库IP -U 生产数据库账号 -d 生产数据库实例 -t wh_photo -f wh_photo.sql\n-- pg_dump -h 192.168.200.12 -U sneaky -d sneaky -t pw_item_detail -f pw_item_detail.sql\n-- DYHY$D#e8@q\n-- psql -h localhost -U test -d postgres -f gift.sql")]),t._v(" "),r("h3",{attrs:{id:"数据结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#数据结构"}},[t._v("#")]),t._v(" 数据结构")]),t._v(" "),r("ul",[r("li",[t._v("数组")]),t._v(" "),r("li",[r("code",[t._v("sql CREATE TABLE emptable ( 　　arraycol1 integer[], 　　arraycol2 text[][], 　　arraycol3 text[3], -- 数字表示数组长度 　　arraycol4 integer ARRAY, 　　arraycol5 integer ARRAY[4] );")])]),t._v(" "),r("li",[t._v("操作:\n"),r("ul",[r("li",[t._v("<> 不等于")]),t._v(" "),r("li",[t._v("@> 包含")]),t._v(" "),r("li",[t._v("<@ 包含于")]),t._v(" "),r("li",[t._v("&& 重叠")]),t._v(" "),r("li",[t._v("not [A] && [B]")])])]),t._v(" "),r("li",[t._v("字符串")]),t._v(" "),r("li",[t._v("varchar和char 最大长度都是10485760（1GB）, 区别仅在于边长")]),t._v(" "),r("li",[t._v("text和varchar几乎无性能差别，区别仅在于存储结构的不同")])]),t._v(" "),r("h3",{attrs:{id:"注释"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#注释"}},[t._v("#")]),t._v(" 注释")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("添加注释")])]),t._v(" "),r("li",[r("p",[t._v("``` --语法 comment on [type] [target] is [comment]\n--为表添加注释 comment on table user is 'The user table'; --为字段注释 comment on column user.userid is 'The user ID';")]),t._v(" "),r("p",[t._v("```")])]),t._v(" "),r("li",[r("p",[t._v("查询注释")])]),t._v(" "),r("li",[r("p",[t._v("``` --查询字段注释，objsubid为表中字段的序号，从左侧从1开始 select description from pg_description join pg_class on pg_description.objoid = pg_class.oid where relname = 'tablename'")]),t._v(" "),r("p",[t._v("--查询表名、表注释 select relname as tabname, cast(obj_description(relfilenode,'pg_class') as varchar) as comment from pg_class c where relkind = 'r' and relname not like 'pg_%' and relname not like 'sql_%' order by relname")]),t._v(" "),r("p",[t._v("```")])])]),t._v(" "),r("h3",{attrs:{id:"执行计划-explain"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#执行计划-explain"}},[t._v("#")]),t._v(" 执行计划 EXPLAIN")]),t._v(" "),r("ul",[r("li",[r("h5",{attrs:{id:"explain-语法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#explain-语法"}},[t._v("#")]),t._v(" EXPLAIN 语法")])]),t._v(" "),r("li",[r("p",[t._v("``` EXPLAIN [ ( option [, ...] ) ] statement EXPLAIN [ ANALYZE ] [ VERBOSE ] statement")]),t._v(" "),r("p",[t._v("where option can be one of:")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("ANALYZE [ boolean ]\nVERBOSE [ boolean ]\nCOSTS [ boolean ]\nBUFFERS [ boolean ]\nTIMING [ boolean ]\nSUMMARY [ boolean ]\nFORMAT { TEXT | XML | JSON | YAML }\n")])])]),r("p",[t._v("```")])]),t._v(" "),r("li",[r("p",[t._v("ANALYZE 选项为TRUE 会实际执行SQL，并获得相应的查询计划，输出真实执行信息")]),t._v(" "),r("ul",[r("li",[t._v("actual time 执行时间( 节点启动时间...实际需要时间)")])])]),t._v(" "),r("li",[r("p",[t._v("VERBOSE 选项为TRUE 会显示查询计划的附加信息，默认为FALSE。附加信息包括查询计划中每个节点（后面具体解释节点的含义）输出的列（Output），表的SCHEMA 信息，函数的SCHEMA 信息，表达式中列所属表的别名，被触发的触发器名称等。")])]),t._v(" "),r("li",[r("p",[t._v("COSTS 选项为TRUE 会显示每个计划节点的预估启动代价（找到第一个符合条件的结果的代价）和总代价，以及预估行数和每行宽度，默认为TRUE。")])]),t._v(" "),r("li",[r("p",[t._v("BUFFERS 选项为TRUE 会显示关于缓存的使用信息，默认为FALSE。该参数只能与ANALYZE 参数一起使用。缓冲区信息包括共享块（常规表或者索引块）、本地块（临时表或者索引块）和临时块（排序或者哈希等涉及到的短期存在的数据块）的命中块数，更新块数，挤出块数。")])]),t._v(" "),r("li",[r("p",[t._v("TIMING 选项为TRUE 会显示每个计划节点的实际启动时间和总的执行时间，默认为TRUE。该参数只能与ANALYZE 参数一起使用。因为对于一些系统来说，获取系统时间需要比较大的代价，如果只需要准确的返回行数，而不需要准确的时间，可以把该参数关闭。")])]),t._v(" "),r("li",[r("p",[t._v("SUMMARY 选项为TRUE 会在查询计划后面输出总结信息，例如查询计划生成的时间和查询计划执行的时间。当ANALYZE 选项打开时，它默认为TRUE。")])]),t._v(" "),r("li",[r("p",[t._v("FORMAT 指定输出格式，默认为TEXT。各个格式输出的内容都是相同的，其中XML | JSON | YAML 更有利于我们通过程序解析SQL 语句的查询计划，为了更有利于阅读，我们下文的例子都是使用TEXT 格式的输出结果。")])]),t._v(" "),r("li",[r("h5",{attrs:{id:"explain-输出结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#explain-输出结构"}},[t._v("#")]),t._v(" EXPLAIN 输出结构")])]),t._v(" "),r("li",[r("p",[t._v("一个树形结构的 查询计划树, 树的每个节点包括对应节点类型,作用对象以及其它")])]),t._v(" "),r("li",[r("p",[t._v("执行特点")]),t._v(" "),r("ul",[r("li",[t._v("按照查询计划数从低往上执行")]),t._v(" "),r("li",[t._v("基于火山模型执行")])])]),t._v(" "),r("li",[r("h5",{attrs:{id:"节点类型"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#节点类型"}},[t._v("#")]),t._v(" 节点类型")])]),t._v(" "),r("li",[r("p",[t._v("控制节点（Control Node)")])]),t._v(" "),r("li",[r("p",[t._v("扫描节点（ScanNode)")]),t._v(" "),r("ul",[r("li",[t._v("Seq Scan，顺序扫描")]),t._v(" "),r("li",[t._v("Index Scan，基于索引扫描，但不只是返回索引列的值")]),t._v(" "),r("li",[t._v("IndexOnly Scan，基于索引扫描，并且只返回索引列的值，简称为覆盖索引")]),t._v(" "),r("li",[t._v("BitmapIndex Scan，利用Bitmap 结构扫描")]),t._v(" "),r("li",[t._v("BitmapHeap Scan，把BitmapIndex Scan 返回的Bitmap 结构转换为元组结构")]),t._v(" "),r("li",[t._v("Tid Scan，用于扫描一个元组TID 数组")]),t._v(" "),r("li",[t._v("Subquery Scan，扫描一个子查询")]),t._v(" "),r("li",[t._v("Function Scan，处理含有函数的扫描")]),t._v(" "),r("li",[t._v("TableFunc Scan，处理tablefunc 相关的扫描")]),t._v(" "),r("li",[t._v("Values Scan，用于扫描Values 链表的扫描")]),t._v(" "),r("li",[t._v("Cte Scan，用于扫描WITH 字句的结果集")]),t._v(" "),r("li",[t._v("NamedTuplestore Scan，用于某些命名的结果集的扫描")]),t._v(" "),r("li",[t._v("WorkTable Scan，用于扫描Recursive Union 的中间数据")]),t._v(" "),r("li",[t._v("Foreign Scan，用于外键扫描")]),t._v(" "),r("li",[t._v("Custom Scan，用于用户自定义的扫描")])])]),t._v(" "),r("li",[r("p",[t._v("物化节点（Materialization Node)")])]),t._v(" "),r("li",[r("p",[t._v("连接节点（Join Node)")])]),t._v(" "),r("li",[r("p",[t._v("Tips")]),t._v(" "),r("ul",[r("li",[t._v("大多数情况下，Index Scan 要比 Seq Scan 快。但是如果获取的结果集占所有数据的比重很大时，这时Index Scan 因为要先扫描索引再读表数据反而不如直接全表扫描来的快。")]),t._v(" "),r("li",[t._v("如果获取的结果集的占比比较小，但是元组数很多时，可能Bitmap Index Scan 的性能要比Index Scan 好。")]),t._v(" "),r("li",[t._v("如果获取的结果集能够被索引覆盖，则Index Only Scan 因为不用去读数据，只扫描索引，性能一般最好。但是如果VM 文件未生成，可能性能就会比Index Scan 要差。")])])])]),t._v(" "),r("h3",{attrs:{id:"备库"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#备库"}},[t._v("#")]),t._v(" 备库")]),t._v(" "),r("ul",[r("li",[t._v("PostgreSQL 的基于流复制的物理备库是基于redo的物理块复制备库，允许开放只读的功能，但是需要注意，由于主库可能不断的产生redo，这些redo可能会与备库的QUERY产生冲突。")])]),t._v(" "),r("h3",{attrs:{id:"常用命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[t._v("#")]),t._v(" 常用命令")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("\\h：查看SQL命令的解释，比如\\h select。\n\\?：查看psql命令列表。\n\\l：列出所有数据库。\n\\c [database_name]：连接其他数据库。\n\\d：列出当前数据库的所有表格。\n\\d [table_name]：列出某一张表格的结构。\n\\du：列出所有用户。\n\\e：打开文本编辑器。\n\\conninfo：列出当前数据库和连接的信息。\n\\password uesrname :修改数据库用户密码。\n\n\n\\dn: 查看模式\n\\dS+: 查看系统表, S表示系统\n")])])]),r("h3",{attrs:{id:"自定义函数"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#自定义函数"}},[t._v("#")]),t._v(" 自定义函数")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("基础概念")])]),t._v(" "),r("li",[r("p",[t._v("schema")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("类似于命名空间,或者是一个文件系统中的目录, schema不能嵌套,同一schema下不能有同名对象")])]),t._v(" "),r("li",[r("p",[t._v("pg_catalog存放了各系统表,内置函数")])]),t._v(" "),r("li",[r("table",[r("thead",[r("tr",[r("th",[t._v("目录名")]),t._v(" "),r("th",[t._v("用途")]),t._v(" "),r("th",[t._v("...")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-aggregate.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_aggregate")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("聚集函数")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-am.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_am")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("索引访问方法")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-amop.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_amop")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("访问方法操作符")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-amproc.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_amproc")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("访问方法支持过程")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-attrdef.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_attrdef")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("列默认值")]),t._v(" "),r("td",[t._v("✅")])]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-attribute.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_attribute")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("表列(“属性”)")]),t._v(" "),r("td",[t._v("✅")])]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-authid.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_authid")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("认证标识符（角色）")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-auth-members.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_auth_members")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("认证标识符成员关系")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-cast.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_cast")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("转换（数据类型转换）")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-class.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_class")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("表、索引、序列、视图 （“关系”）")]),t._v(" "),r("td",[t._v("✅")])]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-collation.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_collation")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("排序规则（locale信息）")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-constraint.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_constraint")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("检查约束、唯一约束、主键约束、外键约束")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-conversion.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_conversion")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("编码转换信息")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-database.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_database")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("本数据库集簇中的数据库")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-db-role-setting.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_db_role_setting")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("每角色和每数据库的设置")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-default-acl.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_default_acl")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("对象类型的默认权限")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-depend.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_depend")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("数据库对象间的依赖")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-description.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_description")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("数据库对象上的描述或注释")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-enum.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_enum")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("枚举标签和值定义")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-event-trigger.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_event_trigger")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("事件触发器")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-extension.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_extension")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("已安装扩展")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-foreign-data-wrapper.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_foreign_data_wrapper")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("外部数据包装器定义")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-foreign-server.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_foreign_server")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("外部服务器定义")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-foreign-table.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_foreign_table")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("外部表信息")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-index.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_index")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("索引信息")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-inherits.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_inherits")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("表继承层次")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-init-privs.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_init_privs")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("对象初始特权")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-language.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_language")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("编写函数的语言")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-largeobject.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_largeobject")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("大对象的数据页")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-largeobject-metadata.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_largeobject_metadata")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("大对象的元数据")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-namespace.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_namespace")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("模式")]),t._v(" "),r("td",[t._v("✅")])]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-opclass.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_opclass")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("访问方法操作符类")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-operator.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_operator")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("操作符")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-opfamily.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_opfamily")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("访问方法操作符族")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-partitioned-table.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_partitioned_table")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("有关表的分区键的信息")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-pltemplate.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_pltemplate")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("过程语言的模板数据")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-policy.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_policy")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("行安全策略")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-proc.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_proc")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("函数和过程")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-publication.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_publication")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("逻辑复制的发布")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-publication-rel.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_publication_rel")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("与发布映射的关系")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-range.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_range")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("范围类型的信息")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-replication-origin.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_replication_origin")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("已注册的复制源")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-rewrite.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_rewrite")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("查询重写规则")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-seclabel.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_seclabel")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("数据库对象上的安全标签")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-sequence.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_sequence")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("有关序列的信息")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-shdepend.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_shdepend")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("共享对象上的依赖")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-shdescription.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_shdescription")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("共享对象上的注释")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-shseclabel.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_shseclabel")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("共享数据库对象上的安全标签")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-statistic.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_statistic")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("规划器统计")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-statistic-ext.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_statistic_ext")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("扩展的规划器统计")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-subscription.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_subscription")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("逻辑复制订阅")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-subscription-rel.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_subscription_rel")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("订阅的关系状态")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-tablespace.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_tablespace")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("本数据库集簇内的表空间")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-transform.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_transform")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("转换（将数据类型转换为过程语言需要的形式）")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-trigger.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_trigger")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("触发器")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-ts-config.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_ts_config")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("文本搜索配置")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-ts-config-map.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_ts_config_map")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("文本搜索配置的记号映射")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-ts-dict.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_ts_dict")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("文本搜索字典")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-ts-parser.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_ts_parser")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("文本搜索分析器")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-ts-template.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_ts_template")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("文本搜索模板")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-type.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_type")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("数据类型")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("a",{attrs:{href:"http://www.postgres.cn/docs/10/catalog-pg-user-mapping.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[t._v("pg_user_mapping")]),r("OutboundLink")],1)]),t._v(" "),r("td",[t._v("将用户映射到外部服务器")]),t._v(" "),r("td")])])])]),t._v(" "),r("li",[r("p",[t._v("pg_class")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("目录"),r("code",[t._v("pg_class")]),t._v("记录表和几乎所有具有列或者像表的东西。 这包括索引（但还要参见"),r("code",[t._v("pg_index")]),t._v("）、序列 （"),r("code",[t._v("pg_sequence")]),t._v("）、视图、物化视图、组合类型和TOAST表")])]),t._v(" "),r("li",[r("table",[r("thead",[r("tr",[r("th",[t._v("名称")]),t._v(" "),r("th",[t._v("类型")]),t._v(" "),r("th",[t._v("引用")]),t._v(" "),r("th",[t._v("描述")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[r("code",[t._v("oid")])]),t._v(" "),r("td",[r("code",[t._v("oid")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("行标识符（隐藏属性，必须被显式选择才会显示）")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("relname")])]),t._v(" "),r("td",[r("code",[t._v("name")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("表、索引、视图等的名字")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("relnamespace")])]),t._v(" "),r("td",[r("code",[t._v("oid")])]),t._v(" "),r("td",[r("code",[t._v("pg_namespace.oid")])]),t._v(" "),r("td",[t._v("包含该关系的名字空间的OID")])])])])])])]),t._v(" "),r("li",[r("p",[t._v("pg_attribute")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("存储有关表列的信息。数据库中的每一个表的每一个列都恰好在"),r("code",[t._v("pg_attribute")]),t._v("中有一行。（这其中也会有索引的属性项，并且事实上所有具有"),r("code",[t._v("pg_class")]),t._v("项的对象在这里都有属性项)")])]),t._v(" "),r("li",[r("table",[r("thead",[r("tr",[r("th",[t._v("名称")]),t._v(" "),r("th",[t._v("类型")]),t._v(" "),r("th",[t._v("引用")]),t._v(" "),r("th",[t._v("描述")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[r("code",[t._v("attrelid")])]),t._v(" "),r("td",[r("code",[t._v("oid")])]),t._v(" "),r("td",[r("code",[t._v("pg_class.oid")])]),t._v(" "),r("td",[t._v("列所属的表")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("attname")])]),t._v(" "),r("td",[r("code",[t._v("name")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("列名")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("atttypid")])]),t._v(" "),r("td",[r("code",[t._v("oid")])]),t._v(" "),r("td",[r("code",[t._v("pg_type.oid")])]),t._v(" "),r("td",[t._v("列的数据类型")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("attnum")])]),t._v(" "),r("td",[r("code",[t._v("int2")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("列的编号。一般列从1开始向上编号。系统列（如"),r("code",[t._v("oid")]),t._v("）则拥有（任意）负值编号。")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("attisdropped")])]),t._v(" "),r("td",[r("code",[t._v("bool")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("该列被删除且不再有效。一个删除的列仍然物理存在于表中，但是会被分析器忽略并因此无法通过SQL访问。")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("atttypmod")])]),t._v(" "),r("td",[r("code",[t._v("int4")])]),t._v(" "),r("td"),t._v(" "),r("td",[r("code",[t._v("atttypmod")]),t._v("记录了在表创建时提供的类型相关数据（例如一个"),r("code",[t._v("varchar")]),t._v("列的最大长度）。它会被传递给类型相关的输入函数和长度强制函数。对于那些不需要"),r("code",[t._v("atttypmod")]),t._v("的类型，这个值通常总是为-1。")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("attnotnull")])]),t._v(" "),r("td",[r("code",[t._v("bool")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("这表示一个非空约束。")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("atthasdef")])]),t._v(" "),r("td",[r("code",[t._v("bool")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("该列有一个默认值，在此情况下在"),r("code",[t._v("pg_attrdef")]),t._v("目录中会有一个对应项来真正记录默认值。")])])])])])])]),t._v(" "),r("li",[r("p",[t._v("pg_namespace")]),t._v(" "),r("ul",[r("li",[r("p",[r("code",[t._v("pg_namespace")]),t._v("存储名字空间。名字空间是SQL模式之下的结构：每个名字空间拥有一个独立的表、类型等的集合，且其中没有名字冲突")])]),t._v(" "),r("li",[r("table",[r("thead",[r("tr",[r("th",[t._v("名称")]),t._v(" "),r("th",[t._v("类型")]),t._v(" "),r("th",[t._v("引用")]),t._v(" "),r("th",[t._v("描述")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[r("code",[t._v("oid")])]),t._v(" "),r("td",[r("code",[t._v("oid")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("行标识符（隐藏属性，必须被显式选择才会显示）")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("nspname")])]),t._v(" "),r("td",[r("code",[t._v("name")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("名字空间的名字")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("nspowner")])]),t._v(" "),r("td",[r("code",[t._v("oid")])]),t._v(" "),r("td",[r("code",[t._v("pg_authid.oid")])]),t._v(" "),r("td",[t._v("名字空间的拥有者")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("nspacl")])]),t._v(" "),r("td",[r("code",[t._v("aclitem[]")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("访问权限，详见"),r("a",{attrs:{href:"http://www.postgres.cn/docs/10/sql-grant.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("GRANT"),r("OutboundLink")],1),t._v("和"),r("a",{attrs:{href:"http://www.postgres.cn/docs/10/sql-revoke.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("REVOKE"),r("OutboundLink")],1)])])])])])])]),t._v(" "),r("li",[r("p",[t._v("pg_attrdef")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("存储列的默认值,显示指定时才会有")])]),t._v(" "),r("li",[r("table",[r("thead",[r("tr",[r("th",[t._v("名称")]),t._v(" "),r("th",[t._v("类型")]),t._v(" "),r("th",[t._v("引用")]),t._v(" "),r("th",[t._v("描述")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[r("code",[t._v("oid")])]),t._v(" "),r("td",[r("code",[t._v("oid")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("行标识符（隐藏属性，必须被显式选择才会显示）")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("adrelid")])]),t._v(" "),r("td",[r("code",[t._v("oid")])]),t._v(" "),r("td",[r("code",[t._v("pg_class.oid")])]),t._v(" "),r("td",[t._v("该列所属的表")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("adnum")])]),t._v(" "),r("td",[r("code",[t._v("int2")])]),t._v(" "),r("td",[r("code",[t._v("pg_attribute.attnum")])]),t._v(" "),r("td",[t._v("列号")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("adbin")])]),t._v(" "),r("td",[r("code",[t._v("pg_node_tree")])]),t._v(" "),r("td"),t._v(" "),r("td",[t._v("列默认值的内部表示")])]),t._v(" "),r("tr",[r("td",[r("code",[t._v("adsrc")])]),t._v(" "),r("td",[r("code",[t._v("text")])]),t._v(" "),r("td",[t._v("不推荐使用")]),t._v(" "),r("td",[t._v("默认值的人类可读的表示")])])])])])])]),t._v(" "),r("li",[r("p",[t._v("pg_table_is_visible")]),t._v(" "),r("ul",[r("li",[t._v("该表/视图是否在搜索路径中可见, 返回boolean型")]),t._v(" "),r("li",[t._v("如果一个表所在的模式在搜索路径中，并且没有同名的表出现在搜索路径的更早的地方，那么就说这个表视可见的。 它等效于表可以不带明确模式修饰进行引用。")])])]),t._v(" "),r("li",[r("p",[t._v("format_type")]),t._v(" "),r("ul",[r("li",[t._v("format_type(type_oid,typemod)")]),t._v(" "),r("li",[t._v("获取一个数据类型的SQL名称, 返回字符串")])])]),t._v(" "),r("li",[r("p",[t._v("pg_get_expr")]),t._v(" "),r("ul",[r("li",[t._v("pg_get_expr(expr_text,relation_oid) / pg_get_expr(expr_text,relation_oid, pretty_bool)")]),t._v(" "),r("li",[t._v("反编译一个表达式的内部形式，假设其中的任何Vars都引用第二个参数指出的关系, 返回text")])])]),t._v(" "),r("li",[r("p",[t._v("substring")]),t._v(" "),r("ul",[r("li",[t._v("substring(string [from int] [for int])")]),t._v(" "),r("li",[t._v("抽取字符串")]),t._v(" "),r("li",[t._v("substring(string from pattern)")]),t._v(" "),r("li",[t._v("抽取匹配 POSIX 正则表达式的子字串")]),t._v(" "),r("li",[t._v("substring(string from pattern for escape)")]),t._v(" "),r("li",[t._v("抽取匹配SQL正则表达式的子字串")])])]),t._v(" "),r("li",[r("p",[t._v("查看模式")])]),t._v(" "),r("li",[r("p",[t._v("搜索路径")])]),t._v(" "),r("li",[r("p",[t._v("一般来说，找表可以加Schema，如果不加就找search_path指定的Schema")])])])])]),t._v(" "),r("h3",{attrs:{id:"规则"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#规则"}},[t._v("#")]),t._v(" 规则")]),t._v(" "),r("ul",[r("li",[r("code",[t._v("sql CREATE [OR REPLACE] RULE name AS ON 事件 TO table_name [WHERE condition ] DO [ALSO | INSTEAD] {NOTHING | 命令 | （命令 ; 命令 ......）}")])]),t._v(" "),r("li",[t._v("规则实际上 是一种命令转换机制或者命令宏")]),t._v(" "),r("li",[t._v("这种转换会在命令的执行开始之前进行")])]),t._v(" "),r("h3",{attrs:{id:"error"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#error"}},[t._v("#")]),t._v(" error")]),t._v(" "),r("ul",[r("li",[t._v('duplicate key value violates unique constraint "kick_privilege_pkey"')]),t._v(" "),r("li",[t._v("kick_privilege 表的 kick_privilege_id_seq 小于 max(id), 导致插入数据时,新生成的id 已存在")])]),t._v(" "),r("h3",{attrs:{id:"死锁"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#死锁"}},[t._v("#")]),t._v(" 死锁")]),t._v(" "),r("h4",{attrs:{id:"锁类型"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#锁类型"}},[t._v("#")]),t._v(" 锁类型")]),t._v(" "),r("ul",[r("li",[t._v("行级锁")]),t._v(" "),r("li",[t._v("表级锁")])]),t._v(" "),r("h4",{attrs:{id:"表级锁"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#表级锁"}},[t._v("#")]),t._v(" 表级锁")]),t._v(" "),r("ul",[r("li",[t._v("AcessShareLock（访问共享锁）: 通过在一张表或多张表一条 SELECT 语句检索数据时就会自动获取。这个模式会阻塞在同一张表下的 ALTER TABLE，DROP TABLE 以及 VACUUM(垃圾收集以及可选地分析一个数据库) (AccessExclusiveLock，访问排他锁)操作。")]),t._v(" "),r("li",[t._v("RowShareLock （行共享锁）: 通过一条SELECT...FOR UPDATE子句自动获取。它会在同一张表上阻塞并发的ExclusiveLock(排他锁）以及AccessExclusiveLock(访问排他锁）。")]),t._v(" "),r("li",[t._v("RowExclusiveLock （行排他锁）: 通过UPDATE，INSERT，或者 DELETE命令自动获取。它会在同一张表上阻塞ALTER TABLE，DROP TABLE,VACUUM 和 CREATE INDEX命令。（ShareLock[共享锁]，ShareRowExclusiveLock[共享行排他锁]，ExclusiveLock[排他锁]，AccessExclusiveLock[访问排他锁]）。")]),t._v(" "),r("li",[t._v("ShareLock（共享锁）: 通过CREATE INDEX命令自动获取。它会在同一张表上阻塞INSERT, UPDATE, DELETE, ALTER TABLE, DROP TABLE, 以及 VACUUM命令.(RowExclusiveLock[行排他锁], ShareRowExclusiveLock[共享行排他锁], ExclusiveLock[排他锁], 以及 AccessExclusiveLock[访问排他锁])")]),t._v(" "),r("li",[t._v("ShareRowExclusiveLock（共享行排他锁）: 这个锁模式与ExclusiveLock（排他锁）是一样的，但是它允许获取并发的 RowShareLock（行共享锁）")]),t._v(" "),r("li",[t._v("SHARE UPDATE EXCLUSIVE 锁: 与”Share update exclusive,Share,Share row ,exclusive,exclusive,Access exclusive”模式冲突，这种模式保护一张表不被并发的模式更改和VACUUM; “Vacuum(without full), Analyze ”和 “Create index concurrently”命令会获得这种类型锁。")]),t._v(" "),r("li",[t._v("ExclusiveLock（排他锁）: ”每个事务在它的事务ID的整个时间里都会持有一个Exclusive Lock（排他锁）”。如果一个事务发现它需要特别地等待另一个事务，它就会尝试地在另一个事务ID上获取 Share Lock（共享锁）。这仅当另一个事务结束并释放它自己的锁时才会成功。（注意，冲突）。Exclusive Lock（排他锁）会在同一张表上阻塞INSERT, UPDATE, DELETE, CREATE INDEX, ALTER TABLE,DROP TABLE, SELECT...FOR UPDATE 以及 VACUUM命令。")])]),t._v(" "),r("h4",{attrs:{id:"行级锁"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#行级锁"}},[t._v("#")]),t._v(" 行级锁")]),t._v(" "),r("ul",[r("li",[t._v("Exclusive lock（排他锁）: 当通过UPDATE或DELETE命中行时就会自动获取该锁。锁会一直被持有，直到一个事务提交或回滚了。为了手动获取exclusive-lock（排他锁），可以使用SELECT FOR UPDATE。")]),t._v(" "),r("li",[t._v("Share-Lock（共享锁）：当通过SELECT...FOR SHARE命中行时就会自动获取该锁。")])]),t._v(" "),r("h4",{attrs:{id:"死锁解决办法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#死锁解决办法"}},[t._v("#")]),t._v(" 死锁解决办法")]),t._v(" "),r("ol",[r("li",[t._v("查看数据库进程\n"),r("ol",[r("li",[t._v("SELECT * FROM pg_stat_activity WHERE datname='db name';")])])]),t._v(" "),r("li",[t._v("杀掉进程\n"),r("ol",[r("li",[t._v("SELECT pg_terminate_backend(PID)")])])])])])}),[],!1,null,null,null);e.default=a.exports}}]);