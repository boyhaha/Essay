# 07-多任务

## 

问题

* 多线程和多进程的区别
    * 进程是系统进行资源分配和调度的一个独立单位，线程是进程的一个实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位.线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源；
    * 一个程序至少有一个进程,一个进程至少有一个线程；
    * 线程的划分尺度小于进程(资源比进程少)，使得多线程程序的并发性高；
    * 进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率 ；
    * 线线程不能够独立执行，必须依存在进程中；
    * 线程执行开销小，但不利于资源的管理和保护；而进程正相反
* 进程，线程，协程

```
进程
一个程序的执行实例就是一个进程。每一个进程提供执行程序所需的所有资源。（进程本质上就是资源的集合）进程拥有自己独立的堆和栈，堆和栈都不共享，由操作系统进行调度。

线程
线程是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位。一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每个线程并行执行不同的任务。
线程拥有自己独立的栈，但是堆是共享的，标准的线程也是由操作系统调度的。

进程和线程的区别:
1、进程包含线程
2、线程共享进程内存空间
3、进程内存是独⽴的（不可互相访问）
4、进程可以⽣成⼦进程，⼦进程之间互相不能互相访问（相当于在⽗级进程克隆两个⼦进程）
5、在⼀个进程⾥⾯线程之间可以交流。两个进程想通信，multiprocessing模块支持两种形式pip和queue
6、创建新线程很简单，创建新进程需要对其⽗进程进⾏克隆。
7、⼀个线程可以控制或操作同⼀个进程⾥⾯的其它线程。但进程只能操作⼦进程。
8、⽗进程可以修改不影响⼦进程，但不能修改。
9、线程可以帮助应⽤程序同时做⼏件事

协程
协程是一种用户态的轻量级线程，协程的调度完全由用户控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。
```

* 进程有哪几种状态
    * 就绪状态
    * 执行状态
    * 阻塞状态
* 什么情况下会直接进入等待

## 

## 

## **进程、线程、协程对比**

### **1. 概念**

#### **1.1 进程**

**进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动（运行的程序或者代码）,进程是系统进行资源分配和调度的一个****独立单位**。每个进程都有自己的独立内存空间，不同进程通过进程间通信来通信。由于进程比较重量，占据独立的内存，所以上下文进程间的切换开销（栈、寄存器、虚拟内存、文件句柄等）比较大，但相对比较稳定安全。

#### **1.2 线程**

**线程是进程的一个实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的****基本单位**.线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。线程间通信主要通过共享内存，上下文切换很快，资源开销较少，但相比进程不够稳定容易丢失数据。

#### **1.3 协程**

**协程又称微线程,是一种****用户态的轻量级线程****，协程的调度完全由用户控制**。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。

### **2. 联系和区别**

#### **2.1 线程与进程的比较**

**线程是指进程内的一个执行单元、也是进程内的可调度实体**

线程与进程的区别：

* 同一个进程中的线程共享同一内存空间，但是进程之间是独立的。
* 对主线程的修改可能会影响其他线程的行为，但是父进程的修改（除了删除以外）不会影响其他子进程。
* 一个进程至少有一个线程
* 同一个进程的线程之间可以直接通信，但是进程之间的交流需要借助中间代理来实现。
* 创建新的线程很容易，但是创建新的进程需要对父进程做一次复制，会消耗更多的资源
* 一个线程可以操作同一进程的其他线程，但是进程只能操作其子进程。
* 线程启动速度快，进程启动速度慢（但是两者运行速度没有可比性）。

#### **2.2 协程与线程的比较**

* 一个线程可以有多个协程，这样python中则能使用多核CPU（多进程加协程）。
* 线程进程都是同步机制，而协程则是异步
* 协程能保留上一次调用时的状态，每次协程重新载入时，就相当于进入上一次调用的状态

* 让Python代码并行运行
    * [multiprocessing](https://docs.python.org/3/library/multiprocessing.html)
        * 进程，
        * 代理池， Pool.map()
        * 队列，
        * 管道，
    * os.system（）
    * 子进程模块 subprocess
