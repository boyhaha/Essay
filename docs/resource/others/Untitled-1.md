2021/08/13  本周工作:
周三

1. 入职材料填写

2.  环境搭建

a.   win 环境与 mac 有些许差异, 不太习惯, 耗费了较多时间

3.  base_64 转图片

4.  图片倾斜矫正: 计算的旋转角一直为0, 不能识别图片的倾斜

周四

1.  图片倾斜矫正

    a.  发现截取部分图片之后, 能识别出倾斜角

    b.  对每张图片截取部分后, 计算倾斜角

    c.  然后旋转整张图片

2.  知识图谱平台 -- 实体对比功能 产品评审

3.   知识图谱项目介绍

    a. 项目整体架构

    b.  与java交互接口

c.   正图片转换为base_64编码

周五

1.  运行项目kg-extract-algo-pro

    a.  理解doc 解析, 抽取逻辑

    b.   理解pdf解析, 抽取逻辑

i.  目前还没有一个问题, pdf 解析到的内容为空, 尚未定位到是什么原因

2.  项目代码阅读, 为重构做前期准备

a.  项目结构

b.  请求逻辑

c.  发现问题

3.  dev MongoDB 连接异常, 服务没启动




****

本周工作事项

1. 无框表解析
    1. 原来逻辑梳理
    2. bug修复
    3. 不同底色无框表解析结果对比, 发现底色对结果无影响
    4. 加入无框表后, 对原解析结果的影响
        1. 结果有稍微不同, 有时会把整个表格当做一个单元格, 将内容都合并了, 影响率5%
        2. 接口耗时从 0.5s 变为 0.99s, 多了一次版面分析接口的调用
        3. 鉴于上面的影响, 所以没有在原 PDF解析中添加额外逻辑, 而是作为一个独立组件使用

2. 知识图谱平台代码重构
    1. 框架搭建完成
    2. 多进程日志文件处理 完成
    3. 启动app编写 完成
    4. 外部请求base基类 完成
    5. 解析逻辑细节梳理

3. 原项目遗留问题处理
采用 ThreadPoolExecutor 后, 异步任务日志丢失.
        1. 经研究发现是 异步任务 没有注册回调函数, 未捕获异常并输出log
        2. 解决之后, 调试代码更方便, 更容易发现, 解决bug



下周工作安排

1. word数据抽取
2. 知识平台重构完成


需要的支持
原项目代码错综复杂, 没有对应的需求文档, 所以重构中有些细节还需要 其他同学帮助讲解一下. 以提高重构速度

****

2021 08-23 - 08~27 工作事项

1. 任务需求清单(BM)数据抽取
    1. 熟悉原书籍抽取逻辑
    2. 完成LJ任务清单抽取
    3. HJ任务清单抽取--50%
    4. 抽取开发时长比预想耗时要久, 主要原因如下:
        1. 书籍内容不可控, 会有一些奇怪的现象
        2. 细节较多
        3. 开发过程中没有比较容易发现问题的办法
        4. 测试过程中出现问题时, 无法回退, 需要手动删除已经生成的实体(1000个左右)
2. 知识图谱平台代码重构完成
    1. Word解析
        * 增加本地测试功能(不再需要请求Java端配合)
    2. PDF扫描版解析
    3. PDF非扫描版解析
    4. PDF无框表解析
3. 新一轮迭代功能方案讨论
4. 国产化平台流程测试
5. 为新同学讲解项目流程, 任务清单抽取逻辑

下周工作安排
1. 重构代码自测
2. PDF解析bug修复及功能优化
    1. 表格排序问题
    2. 倾斜图片矫正
3. 新一轮迭代需求设计开发


需要的支持
自测需要Java端配合一下

****
2021-08-30 至 2021-09-03 周报  
本周工作事项

1. 重构代码自测及优化
    1.1 调整图片存储路径
    1.2 外部请求日志未输出具体信息
    1.3 PDF解析优化

2. 修复遗留bug
    2.1 倾斜图片矫正.
        2.1.1 该任务耗时较久, 尝试了一些方法, 一直效果不理想. 后面还是 "张连海" 海哥以及平哥提供了思路
        2.1.2 采用"边缘投影法"处理倾斜文字, 采用"透视变换"处理倾斜表格
        2.1.3 对1000张图片进行测试, 平均增加时长 0.1907s
        2.1.4 根据异常数据, 添加规则排除, 处理细节
    2.2 pdf表格解析只有一个单元格的情况
        2.2.1 有时会把整个表格数据塞到一个大的单元格中, 经过调试, 发现是因为: 没有排除掉表格自身, 导致单元格合并.

3. 新一轮迭代需求设计开发

4. 抽取解析速度慢问题分析
    4.1 经过日志分析, 发现问题出在 Neo4j 上面
    4.2 查询时未指明label, 导致使用 AllNodesScan 进行全表扫描, 节点越多, 耗时越久. 同时也未建立索引
    4.3 查看查询计划(总节点数: 100万,  事件label: 1.8万):
        4.3.1 AllNodesScan           耗时 1100 ms
        4.3.2 指明label                  耗时     32 ms
        4.3.3 指明label, 添加索引     耗时      2 ms
    4.4 后续优化还需Java端配合


下周工作安排
1. Q3-2迭代需求设计开发
2. PDF解析bug修复及功能优化
    2.1 表格排序问题
    2.2 解析结果排序问题
    2.3 PDF without ocr 优化 title 判断

****

本周工作事项

1. Q3-2迭代需求设计开发
    1. Neo4j 数据属性清理
    2. dev Neo4j 数据同步到master
2. PDF解析功能优化
    2.1 PDF without ocr 优化, 提高组件普适性
    2.2 图片预处理时, 添加背景模糊, 提高文本提取准确性
3. 重构后代码自测, 联调. 已完成
4. Pass 部署新项目, 目前已完成并发布dev
5. dev环境自测(30%)
    5.1. 因149上版面分析服务异常, 导致PDF构建流程自测受阻
    5.2. Word构建流程自测无异常
6. 准备演示数据
    6.1. HBB演示添加图片, 以及部分实体
    6.2. master环境添本体, 实体图片; 准备演示数据

下周工作安排
1. Q3-3迭代需求设计开发
2. 整理抽取组件说明, 以及适用的文档类型
3. 准备master环境演示数据

需要的支持
149版面分析服务恢复正常

****
本周工作事项
1. 整理抽取组件说明, 以及适用的文档类型
2. Q3-3迭代需求设计开发
3. 演示数据准备
    1. 本体整理. 添加本体; 设置最优项; 添加属性, 关系, 图片
    2. 实体属性整理. 添加属性; 修改属性, 单位; 添加图片等
    3. 清洗Neo4j labels. 删除异常label; 相似 label归一; 修改不合理关系
    4. 开发环境数据同步数据到dev
    5. 功能测试, 保证演示功能可用
4. dev问题修复以及功能优化
    1. 发现问题. 问题如下(整理时截图未添加, 后续补充)
    2. 问题修复
        1. jieba 每次抽取时都加载?           只是采用多进程之后, 每个进程需要单独加载一次, 并不是每次加载
        2. 抽取到的图片展示异常.              挂载路径错误, 导致图片未挂载到公共服务器上
        3. 抽取耗时问题排查
        4. 解析文档table展示异常.             OCR结果有误差, 导致多出空白行/列, 需对行列做合并
        5. 部分文档抽取结果实体为None.    without ocr 解析结果没有title, 导致抽取异常. 在解析时加入title判断
    3. 优化
        1. 保存图片时进行压缩
        2. 实体图片属性抽取
        3. 内部异常log
        4. 实体清除章节名
5. 校验代码(重构后)抽取效果
    * 对部分文档效果很好, 对部分文档效果很差, 需要优化, 提高通用性

下周工作安排
1. 抽取效果优化, 提高通用性
2. 表格跨页

********
本周工作事项
1. 抽取效果优化, 优化6处
2. dev: bug修复
3. 文档抽取效果测试; 多进程测试(多本书同时抽取); 抽取速度测试
4. 将PDF扫描件中的"figure"区域保存为图片
5. 项目现有问题整理

下周工作安排
1. Q3-3迭代需求设计开发
2. 表格跨页问题
3. 抽取效果优化
4. 扫描件转图片流程变更

需要的支持
"扫描件转图片流程变更" 需要java配合调整逻辑.

****
本周工作事项
1. 抽取效果优化
   1. 扫描件 转图片, 清晰度优化
   2. 任务清单 解析结果优化(当两行间距过大时, 不再合并)
   3. without ocr 过滤面积小于30的图片; 并在开始时, 删除历史图片
   4. "现代战机-美国F4U“海盗”战斗机.pdf" 异常实体过滤
2. pass部署项目, 流程整理, 分享
3. 抽取流程整理, 分享
4. 纸质文档转PDF开发完成, 待联调
5. flat 实体, 关系, 属性抽取 接入(50%)
6. 其他
   1. dev数据同步到master
   2. 星河知识图谱产品白皮书_V1.4

下周工作安排
1. flat 实体, 关系, 属性抽取 接入
2. 图像目标检测

需要的支持
图像目标检测相关服务地址

****
本周工作事项
1. flat 实体, 关系, 属性抽取 接入(已完成)
   1. 三个镜像合并, 压缩
   2. 更新最新flat模型. (该过程因代码与模型不统一, 导致耗时大于预期)
2. 图像目标检测
   1. 图片/文本结构抽取 接口设计
   2. 代码开发(按照原本方案开发完成后, 又根据甘哥的意见重新换了实现方式)
   3. 文本抽取, 目标检测 自测
3. Bug发现, 修复
   1. 部分实体图片抽取错误
   2. 同一个实体, 出现不同label
4. 其他
   1. 英语label 映射到中文label
   2. 纸质文档合并PDF  真实场景测试
   3. 删除异常实体(摩洛哥, 阿尔巴尼亚)
   4. 抽取结果过滤无关系, 无属性实体


下周工作安排
1. bug修复
2. 抽取效果优化

****
本周工作事项
1. 现有书籍扫描
   1. 协助扫描现有书籍
   2. 合并为PDF
   2. 查看抽取效果, 进行优化
2. PDF导出为Word(开发完成)
   1. withoutocr 通过依赖直接转换
   2. 扫描件通过ocr解析结果转换
3. Bug发现, 修复
   1. 目标识别中, 实体图片错误(未转换为前端可获取的图片路径)
   2. 部分图片保存失败(保存图片逻辑错误)
    3. 过滤withoutocr异常图片
4. 抽取效果优化
   1. 异常实体过滤
   2. 若关系中存在"逗号, 顿号", 重新进行实体识别
   3. 图像目标识别结果过滤(人脸, label )


下周工作安排
1. PDF转换为Word联调
2. 配合发现ocr新镜像问题

***
本周工作事项
1. PDF导出为word
   1. 功能联调, 自测
   2. 开放接口
   3. 接口优化
2. 部署知识图谱平台服务(新买的服务器)
   1. 迁移flat, target_detect 镜像
   2. 部署dev, test环境(pass上无目标检测)
   3. 更新最新版本代码, data
   2. 部署流程文档更新, 添加readme.txt
3. 扫描, 抽取现有书籍
   1. 配合抽取现有书籍
   2. 搜索, 整理"武器装备"PDF书籍
   3. 武器知识入库方案探讨
   4. 下轮迭代功能讨论,(文档校对, 实体校对, 词条校对)
   5. 优化抽取效果, 过滤异常实体, 优化抽取速度
4. 其他
   1. 演示环境(211)代码更新, 验证功能是否正常
   2. zbbz 转word, 细节优化
   3. prod新版本发布


下周工作安排
1. Q4-2迭代
2. 配合发现ocr新镜像问题
3. 扫描, 抽取现有书籍

***
本周工作事项
1. prod发布算法最新版本
   1. bug修复
2. Q4-2迭代功能开发
   1. 功能实现方案讨论
   2. 修改解析结果结构
   3. 去重实体中的引号， 便于对齐融合
   4. PDF转Word - 图片相对大小处理
3. 书籍信息整理
4. 分栏文本解析
5. 黑客马拉松

下周工作安排
1. Q4-2迭代
2. 配合发现ocr新镜像问题
3. 迁移黑客马拉松部分功能到知识图谱


***
